# Troubleshoot Learning

Troubleshoot Learning

## Check Examples

If Foyle is learning there should be example files in ${HOME}/.foyle/training

```sh {"id":"01J6DFZ9V3R29TCDEY2AYA8XTV"}
ls -la ~/.foyle/training
```

The output should include `example.binpb` files as illustrated below. 

```
-rw-r--r--    1 jlewi  staff   9895 Aug 28 07:46 01J6CQ6N02T7J16RFEYCT8KYWP.example.binpb
```

If there aren't any then no examples have been learned.

## Did Block Logs Get Created 

* Get the block logs for the cell
* Change the cell ID to the ULID of the cell (you can view this in the markdown)
* The cell should be one that was generated by the AI and you think learning should have occurred on

```bash {"id":"01J6DG428ER427GJNTKC15G6JM"}
CELLID=01J6DFZ9V3R29TCDEY2AYA8XTV
curl http://localhost:8080/api/blocklogs/${CELLID} | jq .
```

* If this returns not found then no log was created for this cell

## Check the logs associated with that cell

* We can search for all logs associated with that cell

```bash {"id":"01J6DG8266XWR99MWK7WZHQAJM"}
export LASTLOG=~/.foyle/logs/raw/$(ls -t ~/.foyle/logs/raw | head -n 1 )
echo "Last log file: ${LASTLOG}"
jq -c "select(.blockId == \"${CELLID}\")" ${LASTLOG}
```

* Check for any errors processing the block
* Note that the above command will only process the most recent log file
* Each time Foyle is restarted it will create a new log file. 

### Did we try to create an example from any cells?

* If Foyle tries to learn from a cell it logs a message [here](https://github.com/jlewi/foyle/blob/4288e91ac805b46103d94230b32dd1bc2f957095/app/pkg/learn/learner.go#L155)

* We can query for that log as follows

```bash {"id":"01J6DH6PRXKD55RQ6333AQH3V7"}
jq -c 'select(.message == "Found new training example")' ${LASTLOG}
```

* If that returns nothing then we know Foyle never tried to learn from any cells
* If it returns something then we know Foyle tried to learn from a cell but it may have failed
* If there is an error processing an example it gets logged [here](https://github.com/jlewi/foyle/blob/4288e91ac805b46103d94230b32dd1bc2f957095/app/pkg/learn/learner.go#L205)
* So we can search for that error message in the logs

```bash {"id":"01J6DHB6FMBF40E5WP0ZACR3B2"}
jq -c 'select(.level == "Failed to write example")' ${LASTLOG}
```

```bash {"id":"01J6DHBT7E3HJ6C7JMTKPHH4XE"}
jq -c 'select(.level == "error" and .message == "Failed to write example")' ${LASTLOG}
```

## Ensure Block Logs are being created

* The query below checks that block logs are being created. 
* If no logs are being processed than there is a problem with the block log processing. 

```bash {"id":"01J6DGNE5HPMA77YBCTXMA3K7Y"}
jq -c 'select(.message == "Building block log")' ${LASTLOG}
```

## Are there any errors in the logs

* The query below should show you any errors in the logs.

```bash {"id":"01J6DHD60NEVF7J6KF4Q26FWBG"}
jq -c 'select(.severity == "error")' ${LASTLOG}
```