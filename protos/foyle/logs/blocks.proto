syntax = "proto3";

import "foyle/v1alpha1/agent.proto";
import "foyle/v1alpha1/doc.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

package foyle.logs;

option go_package = "github.com/jlewi/foyle/protos/go/foyle/logs;logspb";

// BlockLog is the log of what happened to a block. It includes information about how a block was generated (if it
// was generated by the AI) and how it was executed if it was.
message BlockLog {
    string id = 1;
    // gen_trace_id is the trace ID of the generation request
    string gen_trace_id = 2;
    // exec_trace_ids are the trace IDs of the execution requests
    // Doc is the doc that triggered the generated block
    repeated string exec_trace_ids = 3;
    // doc is the doc that triggered the generated block
    Doc doc = 4;
    // generatedBlock is the block generated by the AI
    Block generated_block = 5;

    // executed_block is the final block that was actually executed
    // nil if the block was not executed
    Block executed_block = 6;
    // exit_code is the exit code of the executed block
    int32 exit_code = 7;
    // eval_mode is true if the block was generated as part of an evaluation and shouldn't be used for learning
    bool eval_mode = 8;

    // ResourceVersion is an opaque string that can be used for optimistic concurrency control
    string resource_version = 9;
}